version: "3.8"

secrets:
  openvpn_user:
    file: ./secrets/openvpn_user.secret
  openvpn_password:
    file: ./secrets/openvpn_password.secret

services:
  gluetun:
    image: qmcgaw/gluetun:latest
    container_name: gluetun
    restart: always
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    secrets:
      - openvpn_user
      - openvpn_password
    env_file: ./env/gluetun.env
    volumes:
      - gluetun:/gluetun

  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: always
    env_file: ./env/watchtower.env
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

networks:
  default:
    name: media_network
    driver: bridge
    attachable: true

volumes:
  gluetun:
    driver: local
    driver_opts:
      type: "nfs"
      o: "addr=${NFS_SERVER},rw,tcp,nolock,hard,wsize=65536,rsize=65536"
      device: ":${NFS_VOLUME}/docker_data/gluetun"
